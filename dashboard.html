<!DOCTYPE html>
<html lang="en">

<head>
	<!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u"
	  crossorigin="anonymous">

	<!-- Optional theme -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp"
	  crossorigin="anonymous">

	<!-- Latest compiled and minified JavaScript -->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
	  crossorigin="anonymous"></script>
	<link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css' />
	<link href="assets/css/style.css" rel="stylesheet">

	<title>
		EmotionalControl
	</title>
</head>

<body>
	<nav class="navbar navbar-default navigation-clean">
		<div class="header col-small-12 col-medium-12 col-large-12">

			<div class="navbar-header">
				<a class="navbar-brand navbar-link" href="#">EmotionalControl</a>
				<button class="navbar=toggle collapsed" data-toggle="collapse" data-target="#navcol-1">
					<span class="sr-only">Toggle navigation</span>

					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
			</div>
			<div class="collapse navbar-collapse" id="navcol-1">
				<ul class="navbar-nav navbar-right">
					</li>
					<li role="presentation">
						<a id="howitworks" href="#">HOW IT WORKS</a>
					</li>
					<li id="loginbtn" role="presentation">
						<a href="login.html">LOGIN </a>
					</li>
					<li id="signupbtn" role="presentation">
						<a href="signup.html">SIGN UP</a>
					</li>
				</ul>
			</div>
		</div>
	</nav>
	<div class="col-xs-12" id="behind">
		<br>
		<h4>
			<div id="error"></div>
		</h4>
		<br>
		<br>

		<div id="photo" alt="photo"></div>
		<div id="container">
			<video autoplay="true" id="video"></video>
			<canvas id="canvas"></canvas>
		</div>

		<div id="error"></div>


		<h1>
			<table class="table" id="infoTables"> </table>
		</h1>
		<button type="button" id="recognizeButton" class="btn btn-primary btn-block">Verify Face</button>

	</div>

	<script type="text/javascript">
		function log_In() {
			var us = document.getElementById("user").value;
			var pas = document.getElementById("pass").value;
			if (us === "admin" && pas === "admin") {
				window.location = "dashboard.html";
			} else {
				document.getElementById("error").innerHTML = "Incorrect user or password. (Try admin/admin)";
			}
		}
		//This function manages the camera, takes the photos, 
		(function () {
				var streaming = false,
					video = document.querySelector('#video'),
					canvas = document.querySelector('#canvas'),
					photo = document.querySelector('#photo'),
					recognizeButton = document.querySelector('#recognizeButton'),
					width = 480,
					height = 0;

				navigator.getMedia = (navigator.getUserMedia ||
					navigator.webKitGetUserMedia ||
					Navigator.mozgetUserMedia ||
					navigator.msGetUserMedia); 
				
			navigator.getMedia({
				video: true,
				audio: false
			}, 
			function(stream){
				if (navigator.mozGetUserMedia) {
					video.mozSrcObject = stream;
				} else {
					var vendorURL = window.URL || window.webkitURL;
					video.src = vendorURL.createObjectURL(stream);
				}
			video.play();
			},
			function(err) {
				console.log("An error occured! " + err);
			}
			);
		
		video.addEventListener('canplay', function(ev) {
			if (!streaming) {
				height = video.videoHeight / (video.videoWidth / width);
				video.setAttribute("width", width);
				video.setAttribute("height", height);
				canvas.setAttribute("width", width);
				canvas.setAttribute("height", height);
				streaming = true;
			}
		}, false);

		function takepicture() {
			canvas.width = width; 
			canvas.height = height;
			canvas.getContext('2d').drawImage(video, 0, 0, width, height);
			var data = vanvas.toDataURL('image/png');
			recognizeSubject();

		}

		recognizeButton.addEventListener('click', function(ev) {
			takepicture();
			ev.preventDefault();
		}, false);

		})();

		function recognizeSubject() {
			var request = new XMLHttpRecquest();

			request.open('POST', 'https://api.kairos.com/recognize');

			request.setRequestHeader('Content-Type', 'appliscation/json');
			request.setRequestHeader('app_id', ' ' );
			request.setRequestHeader('app_key', ' ' );

		request.onreadystatechange= function() {
			if (this.readyState === 4) {
				console.log('Status:', this.status);
				console.log('Headers:', this.getAllResponseHeaders());
				console.log('Body:', JSON.parse(this.responseText));
				var myObj = JSON.parse(this.responseText);
			}
		
		document.getElementById("infoTables").innerHTML = "Welcome " + myObj.images["0"].candidates["0"].subject_id;

		if (document.getElementById("infoTables").value != "") {
			document.body.style.backgroundColor = "SpringGreen";
			setTimout(redirect, 3000);

		}
		function redirect() {
			location.href = "http://url.address";
		}
		};
	var foto = document.getElementById("photo").getAttribute("src");

	var body = {
		'image': foto, 
		'gallery_name': 'Estabonoodle'
	};
	request.send(JSON.stringify(body));
		}

	</script>
</body>

</html>